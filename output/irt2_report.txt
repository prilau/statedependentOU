Initial testing for implementation of state-dependent multi-optima Ornstein–Uhlenbeck model on RevBayes



<h2>Methods</h2>

<h3>Simulated data</h3>
I simulated phylogenetic trees and corresponding discrete character histories using scripts modified from May and Moore 2020 publication (Supp. 1). I wrote scripts to model continuous character evolution under state-dependent multi-optima Ornstein–Uhlenbeck process (Supp. 2). 

The algorithem traverses the binary tree in preorder. 















I first simulated 3 phylogenetic trees under a global, time-dependent birth-death process conditioned on the number of taxa sampled using package TESS. The speciation rate and extinction rate constants were set to 1 and 0.5 respectively in all 3 trees. The 3 trees have 100, 250, 500 tips respectively. For the ease of subsequent analyses, the branch lengths were then normalised so that the root-to-tip length equals 1. 

Next, I simulated 4 replicates of binary discrete trait history for each tree. I specified the expected number of state changes to be 10, with equal forward and reverse transition rates, with at least 20% of the tips in each state. 

For each replicate of discrete trait history, 5 replicates of continous traits were simulated. All replicates share the same parameters of half life 0.35, theta = 0.5 and 2, and stationary variance = 0.0625. The initial value was always set to 0.5, I approximated the continous-time evolution by dividing branch lengths into subsections of length 0.001 and run the equation. 

Altogether, 60 continous trait datasets from 12 discrete trait histories from 3 trees were generated for subsequent model testing.

<h3>Model validation</h3>
Model validation performed in two ways - (1)comparing the results from different MCMC replicates, and (2)5-fold cross-validation. 



<h3>Model power testing</h3>


<h3>Testing with empirical data</h3>
The Gobiiformes are an order of Actinopterygian fishes. Along with some other 30,000 Actinopterygian fish species, have shown size-by-habitat-use patterns, agreeing to the state-dependent continuous-character evolution hypothesis (Clarke 2021). 

The dataset containing habitat and body length information was a subset of fish trait data used by Clarke 2021 compiled from several sources. A total of 465 Gobiiformes species from 164 genera, 7 families were included in this study. Habitats were categorised into 6 types based on salinity: (i) exclusively marine; (ii) marine-brackish; (iii) exclusively brackish; (iv) freshwater-brackish; (v) exclusively freshwater; and (vi) euryhaline. Species with either total length or standard length measured were all included in this study, undistinguishably as 'body length'. Body lengths were measured in centimeter and I used the natural log of body lengths for subsequent analyses. The tree

Here, I ran the data under the sdOU model to test if it robustly support the size-by-habitat-use hypothesis.






sim2: n100d1c3 mcmc run1: empty??

!! number of state changes:number of tree tips ratio affects?
bimodal found~
mcmc iterations -> not much effect, less bimodal actually
hb prior? -> halflife too high previously, but still, not satisfactory
if discrete affects more - but how? (recent state switch worse?)
disc vs cont only studied when well sampled



Simulations under the state-dependent OU process. The process is either in discrete state 0 (blue) or discrete state 1 (orange), where the rate of change between discrete state, half life to reach the optimum, and rate of evolution(?) are equal (⁠q01=q10=1; halflife0=halflife1=0.35; sigma20=sigma21=?⁠), and the optimum of continuous-character evolution is larger when the process is in the orange state (⁠theta0=0.5⁠, theta1=2⁠). A) A single sample path from t=0 to t=1⁠. The process begins and ends in the blue state, but spends some time in the orange state. 

B) The distribution of end states for 10 million simulated realizations. Solid lines represent the simulated joint probability densities of the discrete and continuous states. Dashed lines represent the normal densities with parameters estimated from the simulated end states. Note that the simulated densities depart from the normal densities (both Kolmogorov–Smirnov P−value<2E−16).




figures:
1. one tree + discrete trait history as example
2. (tbd) cont trait evo against time (a couple of taxa, showing branching events; needa log cont simulation)
3. under diff sets of paramters, cont value against time (to illustrate sdOU process; focus on diff optima)
4. sim2 figure (skeleton done)
5. sim3 figure (modified from 4.)
7. empirical figure (posteriors, 2 by 2 facets)



introduction

Evolution of a trait is not completely random, subject to xxx


adaptive evolution in a phylogenetic context

phylogeny poses contraints on trait evolution
evolution of one trait may be influenced by the state of another trait - co-evolution of traits
If trait is independent of influences (intrinsic, e.g. choice; and extrinsic, e.g. environmental), should follow brownian motion. -> no!


Brownian motion: direction and magnitude of evolution independent of selective pressure
rate of evolution

Adaptive evolution
Darwin: modify by descent
evolution towards an optimum: OU process